<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.css ">
    <link rel="stylesheet" href="css/styles.css">
    <title>asd</title>
    <script src="//code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="/js/jquery.scroll_to.js"></script>
    <script src="/js/jquery.debounce.min.js"></script>
</head>


<body>
    <div class="mobile-menu hide">
        <a href="#" class="menu open">&#9776;</a>
        <a href="#" class="menu close hide">&#9776;</a>
        <ul>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>

    <ul class="sublime-menu hide">
    </ul>
    <div class="container">
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
        <h1>Hello</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Unde, vel! Repellendus sit amet, dignissimos! Obcaecati aperiam consequatur quasi ipsam libero praesentium soluta aliquid tempore reprehenderit ad, minima molestiae cumque reiciendis.</p>
    </div>
    <div class="container">
        <div class="section">
            <header data-title="Title 1">Title 1</header>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>1</strong>miau ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>2</strong> ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
        </div>
        <div class="section">
            <header data-title="Title 2">Title 2</header>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>1</strong>miau ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>2</strong> ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
        </div>
        <div class="section">
            <header data-title="Title 3">Title 3</header>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>1</strong>miau ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>2</strong> ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>2</strong> ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
        </div>
        <div class="section">
            <header data-title="Title 4">Title 4</header>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>1</strong>miau ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>2</strong> ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
        </div>
        <div class="section">
            <header data-title="Title 5">Title 5</header>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>1</strong>miau ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
            <div class="slide" data-title="title X">
                <div class="content has_zoom">
                    <p><strong>2</strong> ipsum dolor sit amet, consectetur adipisicing elit. Nulla vitae ab est culpa quam sint ut reprehenderit nam dolorem facere, recusandae ducimus quaerat nisi placeat, vel deleniti facilis eos asperiores.</p>
                </div>
            </div>
        </div>
    </div>
    <script>
    var ReporteSimple = function(theItem, parentContainer, headerContainer) {
        var vm = this;

        this.headerContainer = (typeof headerContainer != "undefined") ? headerContainer : 'header';
        this.parentContainer = (typeof parentContainer != "undefined") ? parentContainer : 'section';
        this.theItem = (typeof theItem != "undefined") ? theItem : 'article';
        $(window).scroll($.debounce(100, function() {
            vm.positionSlides();
        }));


        window.addEventListener('scroll', function() {
            vm.positionHeaders();
        });

        document.onkeydown = function(event) {

            event = event || window.event;

            if (event.keyCode == 34 || event.keyCode == 39 || event.keyCode == 40) {
                event.preventDefault ? event.preventDefault() : event.returnValue = false;
                vm.goNextSlide();
            } else if (event.keyCode == 33 || event.keyCode == 37 || event.keyCode == 38) {
                event.preventDefault ? event.preventDefault() : event.returnValue = false;
                vm.goPrevSlide();
            }

        };

        $(window).resize($.debounce(400, function() {
            vm.getHeights();
            vm.positionSlides();

        }));
        vm.getViewport();
        vm.getHeights();
    };


    ReporteSimple.prototype.getViewport = function() {

        var viewPortWidth;
        var viewPortHeight;

        if (typeof window.innerWidth != 'undefined') {
            viewPortWidth = window.innerWidth;
            viewPortHeight = window.innerHeight;
        } else if (typeof document.documentElement != 'undefined' && typeof document.documentElement.clientWidth !=
            'undefined' && document.documentElement.clientWidth !== 0) {
            viewPortWidth = document.documentElement.clientWidth;
            viewPortHeight = document.documentElement.clientHeight;
        } else {
            viewPortWidth = document.getElementsByTagName('body')[0].clientWidth;
            viewPortHeight = document.getElementsByTagName('body')[0].clientHeight;
        }

        this.viewport = [viewPortWidth, viewPortHeight];
    };

    ReporteSimple.prototype.positionSlides = function() {
        var vm = this;
        // debugger;
        $(vm.parentContainer).each(function() {
            var el = $(this),
                offset = el.offset(),
                scrollTop = ($(window).scrollTop() + ((vm.viewport[1]) / 2));
            if ((scrollTop > offset.top) && (scrollTop < offset.top + el.height())) {
                $(vm.theItem, this).each(function() {

                    $(this).removeClass('active_slide');
                    var el = $(this),
                        offset = el.offset(),
                        scrollTop = ($(window).scrollTop() + ((vm.viewport[1]) / 2));


                    if ((scrollTop > offset.top) && (scrollTop < offset.top + el.height())) {
                        var thisZoom = $('.has_zoom', this);
                        $(this).addClass('active_slide');
                        $.scrollTo((el.offset().top + 5), 400);
                        $('.normal').not(thisZoom).removeClass('normal').addClass('zoom');
                        thisZoom.removeClass('zoom').addClass('normal');
                    }

                });
            }
        });

    };

    ReporteSimple.prototype.positionHeaders = function() {
        var vm = this;
        var menu = false;
        // debugger;
        $(vm.parentContainer).each(function() {
            var el = $(this),
                offset = el.offset(),
                scrollTop = $(window).scrollTop();
            if ((scrollTop > offset.top) && (scrollTop < offset.top + el.height())) {
                floatingHeader = $(vm.headerContainer, this);
                floatingHeader.attr('style', 'position:fixed');
                menu = true;

            } else {
                $(vm.headerContainer, this).css('position', 'relative');
            }
        });

        if (menu) {
			$('.mobile-menu').removeClass('hide');
			$('.sublime-menu').removeClass('hide');
        }else{
        	$('.mobile-menu').addClass('hide');
			$('.sublime-menu').addClass('hide');
        }

    };

    ReporteSimple.prototype.getHeights = function() {
        var vm = this;
        $(vm.parentContainer).each(function() {
            $(this).css('height', ($('' + vm.theItem, this).length * vm.viewport[1]));
            $(vm.theItem, this).css('height', (vm.viewport[1]));
        });
        $('.has_zoom').addClass('zoom');
        $(vm.headerContainer).each(function(){
        	debugger;
        	var bgc = $(this).css('background-color')
        	var color =vm.contrastingColor(bgc.replace('rgb(','').replace(')','').split(', '));
        	var data_title = $(this).attr('data-title') ? $(this).attr('data-title') : $(this).text();
        	$('.sublime-menu').append('<li class="section_marker" style="background-color:'+bgc+';color:#'+color+'">'+data_title+'</li>');
        });
    };

    ReporteSimple.prototype.contrastingColor = function(color) {
    	var vm = this;
	    return (vm.luma(color) >= 165) ? '000' : 'fff';
	};
	ReporteSimple.prototype.luma = function(color) {
		var vm = this;
	    var rgb = (typeof color === 'string') ? hexToRGBArray(color) : color;
	    return (0.2126 * rgb[0]) + (0.7152 * rgb[1]) + (0.0722 * rgb[2]); // SMPTE C, Rec. 709 weightings
	};

    ReporteSimple.prototype.goNextSlide = function() {
        var vm = this;
        if ($('.active_slide').next(vm.theItem).length) {
            $.scrollTo(($('.active_slide').next(vm.theItem).offset().top + 5), 400);
            $('.active_slide').removeClass('active_slide').next(vm.theItem).addClass('active_slide');
        } else if ($('.active_slide').parent().next(vm.parentContainer).length) {
            $.scrollTo(($('.active_slide').parent().next(vm.parentContainer).find(vm.theItem).first().offset().top + 5), 400);
            $('.active_slide').removeClass('active_slide').parent().next(vm.parentContainer).find(vm.theItem).first().addClass('active_slide');
        }

    };
    ReporteSimple.prototype.goPrevSlide = function() {
        var vm = this;


        if ($('.active_slide').prev(vm.theItem).length) {
            $.scrollTo(($('.active_slide').prev(vm.theItem).offset().top + 5), 400);
            $('.active_slide').removeClass('active_slide').prev('.slide').addClass('active_slide');
        } else if ($('.active_slide').parent().prev(vm.parentContainer).length) {
            $.scrollTo(($('.active_slide').parent().prev(vm.parentContainer).find(vm.theItem).last().offset().top + 5), 400);
            $('.active_slide').removeClass('active_slide').parent().prev(vm.parentContainer).find(vm.theItem).last().addClass('active_slide');
        }

    };




    new ReporteSimple('.slide', '.section');
    $(document).on('click', '.sublime-menu li.active', function(event) {
        event.preventDefault ? event.preventDefault() : event.returnValue = false;
        $(this).removeClass('active');
    });
    $(document).on('click', '.sublime-menu li', function(event) {
        event.preventDefault ? event.preventDefault() : event.returnValue = false;
        $( '.sublime-menu li.active').removeClass('active');
        $(this).addClass('active');
    });
    $(document).on('click', '.menu.open', function(event) {
        event.preventDefault ? event.preventDefault() : event.returnValue = false;
        $(this).html('&times;').removeClass('open').addClass('close');
        $('.mobile-menu').addClass('slide_left');
    });
    $(document).on('click', '.menu.close', function(event) {
        event.preventDefault ? event.preventDefault() : event.returnValue = false;
        $(this).html('&#9776;').removeClass('close').addClass('open');
        $('.mobile-menu').removeClass('slide_left');
    });
    $(document).on('click', 'header', function(event) {
        var header = $(this);
        event.preventDefault ? event.preventDefault() : event.returnValue = false;
        // debugger;
        if ($(this).parent('.section.closed').length) {
            $(this).parent('.section').animate({
                // opacity: 0.25,
                // left: "+=50",
                height: $(this).parent('.section').attr('data-originalHeight')
            }, 500, function() {
                $('header', this).css('position', 'fixed');
                $(this).removeClass('closed');
                $.scrollTo(($(this).offset().top), 400);

            });
        } else {
            $(this).parent('.section').attr('data-originalHeight', $(this).parent('.section').height());
            $(this).parent('.section').animate({
                // opacity: 0.25,
                // left: "+=50",
                height: header.height()
            }, 500, function() {
                $('header', this).css('position', 'relative');
                $(this).addClass('closed');
                // $.scrollTo(($(this).offset().top), 400);

            });
        }


    });
    </script>
